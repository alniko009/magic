(function(b){b(document).ready(function(){function n(a){this.id="timeline-event-"+l;this.el=b(a);this.node=this.el.find(".timeline-event-node");this.content=this.el.find(".timeline-content");this.title=this.el.find(".timeline-title");this.height=this.left=0;this.el.attr("id",this.id);l++}function d(a){this.id="timeline-"+m;m++;this.el=b(a);this.arrowWidth=this.draggableWidth=this.eventNodeWidth=this.timelineWidth=this.arrow=this.container=this.draggable=this.events=0;this.eventNodes=[];this.activeTitle=
this.activeEvent=!1;this.el.attr("id",this.id);this.el.prepend('<div class="timeline-body">\n\t<div class="timeline-draggable nickys-draggable"></div>\n</div>\n<div class="timeline-arrow"></div>\n<div class="timeline-container">\n</div>\n');e=0;this.el.find(".timeline-event").each(function(){b(this).prepend('<div class="timeline-event-node" id="timeline-event-node-'+e+'"></div>');e++});var c=this.el.find(".timeline-event");this.events=[];this.draggable=this.el.find(".timeline-draggable");this.container=
this.el.find(".timeline-container");this.eventNodes=this.el.find(".timeline-event-node");this.arrow=this.el.find(".timeline-arrow");for(a=0;a<c.length;a++)this.events[a]=new n(c[a]),this.events[a].height=this.events[a].content.outerHeight();this.timelineWidth=this.el.innerWidth();this.eventNodeWidth=b(this.eventNodes[0]).outerWidth();this.draggableWidth=this.draggable.outerWidth();this.arrowWidth=this.arrow.outerWidth();for(a=c=0;a<this.events.length;a++)c=this.timelineWidth/(this.events.length-1)*
a-this.eventNodeWidth/2,0==a&&(c=this.draggableWidth/2-this.eventNodeWidth/2),a==this.events.length-1&&(c=this.timelineWidth-this.eventNodeWidth/2-this.draggableWidth/2),this.events[a].el.find(".timeline-event-node").css({left:c}),this.events[a].left=c;for(a=c=0;a<this.events.length;a++)c=0==a?0:a==this.events.length-1?this.timelineWidth-this.events[a].title.outerWidth():this.timelineWidth/(this.events.length-1)*a-this.events[a].title.outerWidth()/2,this.events[a].title.css({left:c})}var i=[],m=0,
e=0,l=0;d.prototype.showEvent=function(a){a!=this.activeEvent||!this.activeEvent?(this.activeEvent=a,this.draggable.animate({left:this.events[a].left-(this.draggableWidth/2-this.eventNodeWidth/2)},200),this.el.find(".selected-event").removeClass("selected-event"),this.events[a].node.addClass("selected-event"),this.arrow.animate({left:this.events[a].left-this.arrowWidth/2+this.eventNodeWidth/2},200),0==a?this.container.css({"border-radius":"0 6px 6px 6px"}):a==this.events.length-1?this.container.css({"border-radius":"6px 0 6px 6px"}):
this.container.css({"border-radius":"6px 6px 6px 6px"}),this.container.animate({height:this.events[a].el.find(".timeline-content").outerHeight()},400).css({overflow:"visible !important"}),this.el.find(".active-content").fadeOut(200).removeClass("active-content"),this.events[a].content.fadeIn(200).addClass("active-content"),this.el.find(".timeline-active-title").fadeOut(200).removeClass("timeline-active-title"),this.activeTitle=!1):this.draggable.animate({left:this.events[a].left-(this.draggableWidth/
2-this.eventNodeWidth/2)},200)};d.prototype.dragging=function(){var a=this.draggable.position().left,a=Math.round((a-(this.draggableWidth/2-this.eventNodeWidth/2))/(this.timelineWidth/(this.events.length-1)));a!=this.activeTitle&&(this.activeTitle=a,this.el.find(".timeline-active-title").fadeOut(200).removeClass("timeline-active-title"),this.events[a].title.fadeIn(200).addClass("timeline-active-title"))};d.prototype.finishedDragging=function(){var a=this.draggable.position().left;this.showEvent(Math.round((a-
(this.draggableWidth/2-this.eventNodeWidth/2))/(this.timelineWidth/(this.events.length-1))))};b(".timeline-wrap").each(function(){var a=new d(b(this));a.showEvent(0);i.push(a)});b(".timeline-title").on("click",function(){var a=b(this).closest(".timeline-wrap").attr("id").replace("timeline-","");i[a].showEvent(b(this).closest(".timeline-event").attr("id").replace("timeline-event-",""))});b(".timeline-event-node").on("click",function(){var a=b(this).closest(".timeline-wrap").attr("id").replace("timeline-",
"");i[a].showEvent(b(this).attr("id").replace("timeline-event-node-",""))});(function(){var a=!1,c=!1,g,d,j,k,h,f,e=!1;b(".nickys-draggable").on("mousedown.nickys-draggable",function(){c=!0;g=b(this);f=i[b(this).closest(".timeline-wrap").attr("id").replace("timeline-","")];h=g.closest(".timeline-wrap").innerWidth();"none"!=b(".timeline-title").first().css("display")&&(e=!0);return!1});b(document).on("mousemove.nickys-draggable",function(b){c&&(c=!1,a=!0,k=b.pageX,d=g.position().left);a&&(j=b.pageX,
left=d+j-k,0>left?left=0:left+f.draggableWidth>h&&(left=h-f.draggableWidth),g.css({left:left}),e||f.dragging(left))});b(document).on("mouseup.nickys-draggable",function(){a&&(a=!1,f.finishedDragging())});b(".timeline-draggable").get(0).addEventListener("touchstart",function(a){var d=a.touches[0],e=d.pageX,d=d.pageY;if(e>b(".timeline-body").offset().left&&e<b(".timeline-body").offset().left+b(".timeline-body").width()&&d>b(".timeline-body").offset().top&&d<b(".timeline-body").offset().top+b(".timeline-body").height())return a.preventDefault(),
c=!0,g=b(this),f=i[b(this).closest(".timeline-wrap").attr("id").replace("timeline-","")],h=g.closest(".timeline-wrap").innerWidth(),!1},!1);document.addEventListener("touchmove",function(b){if(c){b.preventDefault();var e=b.touches[0];c=!1;a=!0;k=e.pageX;d=g.position().left}a&&(b.preventDefault(),e=b.touches[0],j=e.pageX,left=d+j-k,0>left?left=0:left+f.draggableWidth>h&&(left=h-f.draggableWidth),g.css({left:left}),f.dragging(left))},!1);document.addEventListener("touchend",function(b){a&&(a=!1,f.finishedDragging(),
b.preventDefault())},!1)})()})})(jQuery);